version: '3.8'

# =================================================================
# Claw Control - Docker Compose Configuration (Coolify)
# 
# Database is a separate Coolify-managed Postgres resource.
# =================================================================

services:
  # Backend API
  backend:
    build:
      context: ./packages/backend
      dockerfile: Dockerfile
    container_name: claw-control-backend
    environment:
      DATABASE_URL: postgresql://claw:clawcontrol@192.168.1.157:5438/claw_control
      PORT: 3001
    volumes:
      - ./config:/app/config:ro  # Mount config directory (read-only)
      - sqlite_data:/app/data    # SQLite data (only used if DATABASE_URL is sqlite:)
    ports:
      - "3001:3001"
    command: sh -c "npm run migrate && npm start"

  # Frontend
  frontend:
    build:
      context: .
      dockerfile: packages/frontend/Dockerfile
    container_name: claw-control-frontend
    environment:
      VITE_API_URL: https://claw-control-api.escalator.dev
      PORT: "80"
    ports:
      - "5173:80"
    depends_on:
      - backend

volumes:
  sqlite_data:
